# AIè·¯çº¿è§„åˆ’BDDé›†æˆæµ‹è¯•

## æ¦‚è¿°

æœ¬æµ‹è¯•å¥—ä»¶é‡‡ç”¨è¡Œä¸ºé©±åŠ¨å¼€å‘(BDD)æ–¹æ³•ï¼Œä¸ºAIè·¯çº¿è§„åˆ’ç³»ç»Ÿæä¾›ç«¯åˆ°ç«¯çš„é›†æˆæµ‹è¯•ï¼Œé‡ç‚¹è¦†ç›–LLMæœåŠ¡å’Œè§†è§‰æ¸²æŸ“åŠŸèƒ½çš„å…³é”®è·¯å¾„ã€‚

## æµ‹è¯•æ¶æ„

```
tests/bdd/
â”œâ”€â”€ features/                    # Gherkinç‰¹æ€§æ–‡ä»¶
â”‚   â””â”€â”€ ai_route_planning.feature
â”œâ”€â”€ step_definitions/           # æ­¥éª¤å®šä¹‰
â”‚   â””â”€â”€ ai_route_steps.py
â”œâ”€â”€ test_critical_path.py       # å…³é”®è·¯å¾„æµ‹è¯•
â”œâ”€â”€ conftest.py                 # æµ‹è¯•é…ç½®å’Œfixtures
â”œâ”€â”€ pytest.ini                 # pytesté…ç½®
â”œâ”€â”€ run_tests.py               # æµ‹è¯•è¿è¡Œè„šæœ¬
â””â”€â”€ README.md                  # æœ¬æ–‡æ¡£
```

## å…³é”®è·¯å¾„æµ‹è¯•è¦†ç›–

### ğŸ¯ æ ¸å¿ƒä¸šåŠ¡æµç¨‹
- **ç”¨æˆ·è¾“å…¥è§£æ**: è‡ªç„¶è¯­è¨€ â†’ ç»“æ„åŒ–åœ°ç‚¹æ•°æ®
- **LLMæœåŠ¡é›†æˆ**: åœ°ç‚¹è§£æ + è·¯çº¿ç”Ÿæˆ
- **è§†è§‰æ¸²æŸ“**: è·¯çº¿æ•°æ® â†’ å¯è§†åŒ–åœ°å›¾
- **ç«¯åˆ°ç«¯æµç¨‹**: å®Œæ•´çš„ç”¨æˆ·ä½“éªŒè·¯å¾„

### ğŸ” æµ‹è¯•åœºæ™¯åˆ†ç±»

#### 1. å…³é”®è·¯å¾„æµ‹è¯• (`@critical_path`)
- âœ… ç«¯åˆ°ç«¯è‡ªç„¶è¯­è¨€è¾“å…¥æµ‹è¯•
- âœ… å¤šç§è¾“å…¥æ ¼å¼æ”¯æŒæµ‹è¯•
- âœ… å¤æ‚è·¯çº¿æ€§èƒ½æµ‹è¯•
- âœ… è§†è§‰æ¸²æŸ“è´¨é‡éªŒè¯
- âœ… APIç«¯ç‚¹é›†æˆæµ‹è¯•

#### 2. LLMé›†æˆæµ‹è¯• (`@llm_integration`)
- âœ… åœ°ç‚¹è§£æå‡†ç¡®æ€§éªŒè¯
- âœ… è·¯çº¿ç”Ÿæˆé€»è¾‘æµ‹è¯•
- âœ… LLMæœåŠ¡é™çº§å¤„ç†
- âœ… å¤šè¯­è¨€è¾“å…¥æ”¯æŒ

#### 3. è§†è§‰æ¸²æŸ“æµ‹è¯• (`@visual_rendering`)
- âœ… å›¾åƒè´¨é‡éªŒè¯
- âœ… å¯è®¿é—®æ€§æ ‡å‡†æ£€æŸ¥
- âœ… å¤šè®¾å¤‡é€‚é…æµ‹è¯•
- âœ… æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

#### 4. æ€§èƒ½æµ‹è¯• (`@performance`)
- âœ… å“åº”æ—¶é—´åŸºå‡†æµ‹è¯•
- âœ… å¹¶å‘ç”¨æˆ·åœºæ™¯æµ‹è¯•
- âœ… å¤§è§„æ¨¡æ•°æ®å¤„ç†
- âœ… èµ„æºä½¿ç”¨ç›‘æ§

#### 5. é”™è¯¯å¤„ç†æµ‹è¯• (`@error_handling`)
- âœ… æœåŠ¡å¼‚å¸¸é™çº§å¤„ç†
- âœ… ç½‘ç»œé”™è¯¯æ¢å¤æœºåˆ¶
- âœ… æ•°æ®éªŒè¯å’Œæ¸…ç†
- âœ… ç”¨æˆ·å‹å¥½é”™è¯¯æç¤º

#### 6. è¾¹ç•Œæƒ…å†µæµ‹è¯• (`@edge_cases`)
- âœ… å•ä¸ªåœ°ç‚¹å¤„ç†
- âœ… åœ°ç‚¹æ•°é‡é™åˆ¶
- âœ… æ— æ•ˆåœ°ç‚¹è¿‡æ»¤
- âœ… é‡å¤åœ°ç‚¹å»é‡

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-asyncio httpx pytest-html

# ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œ
cd backend && python3 main.py
```

### 2. è¿è¡Œæµ‹è¯•

```bash
# è¿›å…¥æµ‹è¯•ç›®å½•
cd tests/bdd

# è¿è¡Œæ‰€æœ‰å…³é”®è·¯å¾„æµ‹è¯•
python run_tests.py all

# è¿è¡Œå†’çƒŸæµ‹è¯•ï¼ˆå¿«é€ŸéªŒè¯ï¼‰
python run_tests.py smoke

# è¿è¡Œæ€§èƒ½æµ‹è¯•
python run_tests.py performance

# è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
python run_tests.py --markers llm_integration visual_rendering
```

### 3. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåï¼ŒHTMLæŠ¥å‘Šå°†ç”Ÿæˆåœ¨ `tests/bdd/reports/` ç›®å½•ä¸­ã€‚

## æµ‹è¯•é…ç½®

### ç¯å¢ƒå˜é‡
```bash
# åç«¯æœåŠ¡åœ°å€
export BACKEND_URL=http://localhost:8000

# LLMæœåŠ¡é…ç½®
export LLM_CONFIG_PATH=/path/to/llm_config.yaml

# æµ‹è¯•æ•°æ®ç›®å½•
export TEST_DATA_DIR=/path/to/test/data
```

### pytestæ ‡è®°è¯´æ˜

| æ ‡è®° | æè¿° | ç”¨é€” |
|------|------|------|
| `critical_path` | å…³é”®è·¯å¾„æµ‹è¯• | æ ¸å¿ƒä¸šåŠ¡æµç¨‹éªŒè¯ |
| `llm_integration` | LLMé›†æˆæµ‹è¯• | AIæœåŠ¡åŠŸèƒ½éªŒè¯ |
| `visual_rendering` | è§†è§‰æ¸²æŸ“æµ‹è¯• | å›¾åƒç”Ÿæˆè´¨é‡éªŒè¯ |
| `performance` | æ€§èƒ½æµ‹è¯• | å“åº”æ—¶é—´å’Œååé‡ |
| `error_handling` | é”™è¯¯å¤„ç†æµ‹è¯• | å¼‚å¸¸æƒ…å†µå¤„ç† |
| `edge_cases` | è¾¹ç•Œæƒ…å†µæµ‹è¯• | æç«¯è¾“å…¥å¤„ç† |
| `integration` | é›†æˆæµ‹è¯• | APIç«¯ç‚¹é›†æˆ |
| `concurrent_users` | å¹¶å‘æµ‹è¯• | å¤šç”¨æˆ·åœºæ™¯ |
| `smoke` | å†’çƒŸæµ‹è¯• | åŸºæœ¬åŠŸèƒ½éªŒè¯ |

## æµ‹è¯•æ•°æ®

### æ ‡å‡†æµ‹è¯•åœ°ç‚¹
```python
# ç®€å•è·¯çº¿ï¼ˆ3ä¸ªåœ°ç‚¹ï¼‰
simple_route = ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·"]

# å¤æ‚è·¯çº¿ï¼ˆ8ä¸ªåœ°ç‚¹ï¼‰
complex_route = ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "æ·±åœ³", "æ­å·", "å—äº¬", "è¥¿å®‰", "æˆéƒ½"]

# è¾¹ç•Œæƒ…å†µ
edge_cases = [
    "åŒ—äº¬",  # å•ä¸ªåœ°ç‚¹
    "åŒ—äº¬ ç«æ˜Ÿ ä¸Šæµ·",  # åŒ…å«æ— æ•ˆåœ°ç‚¹
    "åŒ—äº¬ åŒ—äº¬ ä¸Šæµ·",  # é‡å¤åœ°ç‚¹
]
```

### æ€§èƒ½åŸºå‡†
- **LLMè§£æ**: < 5ç§’
- **è·¯çº¿ç”Ÿæˆ**: < 3ç§’  
- **è§†è§‰æ¸²æŸ“**: < 2ç§’
- **ç«¯åˆ°ç«¯æµç¨‹**: < 10ç§’
- **å¹¶å‘æˆåŠŸç‡**: > 80%

## æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•éš”ç¦»
- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç‹¬ç«‹è¿è¡Œ
- ä½¿ç”¨fixturesç®¡ç†æµ‹è¯•æ•°æ®
- æµ‹è¯•åè‡ªåŠ¨æ¸…ç†èµ„æº

### 2. é”™è¯¯å¤„ç†
- éªŒè¯é”™è¯¯å“åº”æ ¼å¼
- æ£€æŸ¥é”™è¯¯ç å’Œæ¶ˆæ¯
- æµ‹è¯•é™çº§æœåŠ¡åŠŸèƒ½

### 3. æ€§èƒ½ç›‘æ§
- è®°å½•å…³é”®æ“ä½œè€—æ—¶
- ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ
- è®¾ç½®æ€§èƒ½é˜ˆå€¼å‘Šè­¦

### 4. å¯ç»´æŠ¤æ€§
- ä½¿ç”¨æè¿°æ€§æµ‹è¯•åç§°
- æ·»åŠ è¯¦ç»†çš„æµ‹è¯•æ–‡æ¡£
- å®šæœŸæ›´æ–°æµ‹è¯•ç”¨ä¾‹

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. åç«¯æœåŠ¡è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
python run_tests.py --check-backend

# æ‰‹åŠ¨å¯åŠ¨åç«¯
cd backend && python3 main.py
```

#### 2. LLMæœåŠ¡é…ç½®é”™è¯¯
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat backend/config/llm_config.yaml

# éªŒè¯APIå¯†é’¥
curl -H "Authorization: Bearer YOUR_API_KEY" https://api.openai.com/v1/models
```

#### 3. æµ‹è¯•ä¾èµ–ç¼ºå¤±
```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt

# ä»…å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-asyncio httpx pytest-html
```

#### 4. æƒé™é—®é¢˜
```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x run_tests.py

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la tests/bdd/
```

## æŒç»­é›†æˆ

### GitHub Actionsç¤ºä¾‹
```yaml
name: BDD Integration Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Start backend service
        run: cd backend && python3 main.py &
      - name: Run BDD tests
        run: cd tests/bdd && python run_tests.py all
      - name: Upload test reports
        uses: actions/upload-artifact@v2
        with:
          name: test-reports
          path: tests/bdd/reports/
```

## æ‰©å±•æµ‹è¯•

### æ·»åŠ æ–°çš„æµ‹è¯•åœºæ™¯
1. åœ¨ `features/` ä¸­æ·»åŠ Gherkinåœºæ™¯
2. åœ¨ `step_definitions/` ä¸­å®ç°æ­¥éª¤å®šä¹‰
3. åœ¨ `test_critical_path.py` ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•
4. æ›´æ–° `conftest.py` ä¸­çš„fixtures

### è‡ªå®šä¹‰æµ‹è¯•æ ‡è®°
```python
# åœ¨pytest.iniä¸­æ·»åŠ æ–°æ ‡è®°
markers =
    mobile: ç§»åŠ¨ç«¯æµ‹è¯•
    api_v2: API v2ç‰ˆæœ¬æµ‹è¯•
    security: å®‰å…¨æ€§æµ‹è¯•
```

## è´¡çŒ®æŒ‡å—

1. éµå¾ªç°æœ‰çš„æµ‹è¯•ç»“æ„å’Œå‘½åè§„èŒƒ
2. ä¸ºæ–°åŠŸèƒ½æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹
3. ç¡®ä¿æµ‹è¯•å…·æœ‰è‰¯å¥½çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
4. æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œæ³¨é‡Š

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤Issueã€‚