# Specs 工作流程规范

> **相关文档**：
> - [项目规范](./project_rules.md) - 整体项目规范和角色分工
> - [Git 分支策略](./git_workflow.md) - 分支管理和协作流程

## 基本原则

- 所有项目文档统一放在 `./specs/` 目录
- 文档语言统一使用中文
- 支持"先记录，后实施"的灵活工作方式
- 与Git分支策略无缝集成

## 文档管理

### 存放位置
- **主目录**：`./specs/` 
- **命名规范**：`spec-{编号}-{功能简述}.md`
- **示例**：`spec-1.1-user-auth.md`、`spec-2.3-payment-system.md`

### 文档语言
- **统一中文**：所有文档内容使用中文编写
- **技术术语**：可保留英文技术术语，但需要中文解释
- **注释说明**：代码注释和技术说明使用中文

## 任务状态管理

### 状态定义
- **draft**：想法记录，暂不实施（解决"先记录后实施"需求）
- **in_progress**：正在开发中
- **completed**：已完成
- **blocked**：被外部因素阻塞
- **cancelled**：已取消，不再需要

### 状态转换流程
```
draft ────────→ in_progress ────────→ completed
  │                 │                     ↑
  │                 ↓                     │
  │              blocked ─────────────────┘
  │                 │
  └─────────────→ cancelled ←──────────────┘
```

### 状态转换说明
- **draft → in_progress**：确定开始实施，创建对应Git分支
- **in_progress → completed**：开发完成，合并分支
- **in_progress → blocked**：遇到外部阻塞，暂停开发
- **blocked → in_progress**：阻塞解除，继续开发
- **blocked → completed**：直接解决问题并完成
- **任何状态 → cancelled**：确定不再需要此功能

## 任务规范要求

### 基本要求
- **时间粒度**：每个任务1-2小时完成
- **优先级**：Must / Should / Could / Won't (Moscow方法)
- **必要信息**：功能描述、验收标准、预估时间
- **可选信息**：Git分支、依赖项、阻塞原因

### 任务模板
```markdown
# Spec 1.1 - 用户认证系统

## 基本信息
- **状态**: draft
- **优先级**: Must (核心功能)
- **预估时间**: 2小时
- **负责角色**: @CTO_Linus
- **Git分支**: feature/spec-1.1-user-auth（实施时创建）

## 功能描述
用户可以通过邮箱和密码进行登录和注册

## 验收标准
- [ ] 用户可以注册新账号
- [ ] 用户可以登录已有账号  
- [ ] 登录状态可以持久化
- [ ] 密码加密存储

## 技术要求
- 使用JWT进行身份验证
- 密码使用bcrypt加密
- 支持记住登录状态

## 实施计划
1. 设计数据库表结构
2. 实现注册接口
3. 实现登录接口
4. 前端页面开发
5. 测试和调试

## 依赖关系
- **前置条件**：数据库连接配置完成
- **阻塞因素**：等待第三方API文档
- **后续任务**：用户权限管理系统

## 风险评估
- **技术风险**：低，使用成熟的认证方案
- **时间风险**：中等，可能需要额外调试时间
- **资源风险**：低，不需要额外资源
```

## Git分支集成

### 工作流程
1. **创建Spec** → 状态 `draft`，无需创建分支
2. **准备实施** → 状态 `in_progress`，创建对应分支
3. **开发完成** → 合并分支，状态 `completed`
4. **遇到问题** → 状态 `blocked` 或 `cancelled`

### 分支命名规范
```
Spec 1.1 → feature/spec-1.1-brief-description
Spec 2.3 → feature/spec-2.3-brief-description
```

### 具体操作
- **创建任务**：状态为`draft`，无需创建分支
- **开始实施**：状态改为`in_progress`，创建分支`feature/spec-1.1-user-auth`
- **完成开发**：合并分支，状态改为`completed`
- **遇到问题**：状态改为`blocked`或`cancelled`

## 工具调用方式

### 基本操作
- **检查进度**: 
  ```json
  { "action": { "type": "check" }, "path": "./specs" }
  ```
- **初始化项目**: 
  ```json
  { "action": { "type": "init", "featureName": "功能", "status": "draft" } }
  ```
- **开始实施**: 
  ```json
  { "action": { "type": "start_implementation", "specNumber": "1.1" } }
  ```
- **完成任务**: 
  ```json
  { "action": { "type": "complete_task", "taskNumber": "1.1" } }
  ```
- **更新状态**: 
  ```json
  { "action": { "type": "update_status", "specNumber": "1.1", "status": "blocked" } }
  ```

### 高级操作
- **批量检查**: 
  ```json
  { "action": { "type": "batch_check" }, "filters": { "status": "in_progress" } }
  ```
- **依赖分析**: 
  ```json
  { "action": { "type": "analyze_dependencies" }, "specNumber": "1.1" } }
  ```
- **风险评估**: 
  ```json
  { "action": { "type": "risk_assessment" }, "path": "./specs" } }
  ```

## Moscow优先级评估

### Must Have (必须有)
**判断标准**：
- 没有此功能产品无法运行
- 法律合规要求
- 核心用户流程必需

**实际操作**：
- 当前版本必须实现
- 分配最高优先级资源
- 阻塞其他功能开发

**评估示例**：
- 用户认证系统 → Must（产品基础功能）
- 数据备份机制 → Must（数据安全要求）
- 支付功能 → Must（商业模式核心）

### Should Have (应该有)  
**判断标准**：
- 显著提升用户体验
- 竞品标准功能
- 用户强烈期望

**实际操作**：
- 优先级高但可延期
- 资源充足时优先实现
- 可作为下个版本重点

**评估示例**：
- 用户头像上传 → Should（提升用户体验）
- 消息推送功能 → Should（用户期望功能）
- 数据导出功能 → Should（用户便利性）

### Could Have (可以有)
**判断标准**：
- 锦上添花功能
- 小众用户需求
- 技术展示价值

**实际操作**：
- 资源剩余时考虑
- 可作为实验性功能
- 不影响核心开发进度

**评估示例**：
- 深色模式 → Could（个性化需求）
- 快捷键支持 → Could（高级用户需求）
- 数据可视化 → Could（增值功能）

### Won't Have (暂不做)
**判断标准**：
- 当前资源不足
- 技术风险过高  
- 与产品定位不符

**实际操作**：
- 明确记录不做原因
- 可考虑未来版本
- 避免重复讨论

**评估示例**：
- AI智能推荐 → Won't（技术复杂度高）
- 多语言支持 → Won't（当前用户群体单一）
- 区块链集成 → Won't（与产品定位不符）

## 最佳实践

### 日常工作流
- **开始工作前**：先 `check` 整体进度
- **记录想法时**：创建 `draft` 状态的Spec
- **开始实施时**：状态改为 `in_progress` 并创建Git分支
- **任务完成后**：立即 `complete_task` 并合并分支
- **代码变更时**：必须同步更新文档

### 文件组织
- **保持路径一致性**：避免 specs 目录混乱
- **定期清理**：及时清理已完成的功能分支
- **文档同步**：代码变更必须同步更新Spec状态
- **版本控制**：重要的Spec变更要记录版本历史

### 团队协作
- **状态透明**：团队成员可随时查看所有Spec状态
- **并行开发**：不同Spec可在不同分支并行开发
- **风险控制**：实验性功能可安全地在独立分支试验
- **知识共享**：重要的技术决策要在Spec中记录

### 质量保证
- **验收标准明确**：每个功能都有清晰的验收标准
- **时间控制**：严格控制任务粒度在1-2小时
- **依赖管理**：明确记录任务间的依赖关系
- **风险识别**：提前识别和评估潜在风险

## 常见问题解答

### Q: 什么时候创建Spec？
A: 有任何功能想法时就可以创建draft状态的Spec，不需要等到确定实施。

### Q: 如何处理大功能？
A: 将大功能拆分为多个1-2小时的小任务，每个任务一个Spec。

### Q: Spec可以修改吗？
A: 可以，但要记录修改原因和版本历史，特别是已经开始实施的Spec。

### Q: 如何处理依赖关系？
A: 在Spec中明确记录依赖关系，使用工具分析依赖链，合理安排实施顺序。

### Q: 什么情况下取消Spec？
A: 需求变更、技术风险过高、资源不足或与产品定位不符时可以取消。